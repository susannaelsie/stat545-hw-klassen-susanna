---
title: "cm009 Notes and Exercises: Table Joins"
date: '2017-10-03'
output: github_document
---

```{r}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(gapminder))
```


After going through the `dplyr` [vignette](https://cran.r-project.org/web/packages/dplyr/vignettes/two-table.html) on "two-table verbs", we'll work on the following exercises.


Consider the following areas of countries, in hectares:

```{r}
(areas <- data.frame(country=c("Canada", "United States", "India", "Vatican City"),
                     area=c(998.5*10^6, 983.4*10^6, 328.7*10^6, 44)) %>% 
     as.tbl)
```

## **Mutating joins**

`left_join` (x,y) - keeps everything in the first dataframe that you indicate (new columns will be added from the second datafame - y in this case, but not the new rows from y)

`inner_join` - finds all of the rows in common, eliminates others

`outer_join` - keeps all rows from both dataframes, fills in NA where values are missing 

-- all joins return a single dataframe (a tibble), with columns combined. Different types determine what happens with the rows

## **Filtering Joins**

Filtering joins match obserations in the same way as mutating joins, but affect the observations, not the variables. There are two types:

semi_join(x, y) keeps all observations in x that have a match in y.
anti_join(x, y) drops all observations in x that have a match in y.

## **Set Operations**

The final type of two-table verb is set operations. These expect the x and y inputs to have the same variables, and treat the observations like sets:

intersect(x, y): return only observations in both x and y
union(x, y): return unique observations in x and y
setdiff(x, y): return observations in x, but not in y.

```{r}
library(gapminder)
library(tidyverse)
```


1. To the `gapminder` dataset, add an `area` variable using the `areas` tibble. Be sure to preserve all the rows of the original `gapminder` dataset.

```{r}
left_join(gapminder,areas)
```



2. To the `gapminder` dataset, add an `area` variable using the `areas` tibble, but only keeping obervations for which areas are available. 

```{r}
inner_join(gapminder, areas)
```


3. Use a `_join` function to output the rows in `areas` corresponding to countries that _are not_ found in the `gapminder` dataset. 


```{r}
anti_join(areas, gapminder)
```

4. Use a `_join` function to output the rows in `areas` corresponding to countries that _are_ found in the `gapminder` dataset. 

```{r}
semi_join(areas, gapminder)
```


5. Construct a tibble that joins `gapminder` and `areas`, so that all rows found in each original tibble are also found in the final tibble. 

```{r}
full_join(gapminder, areas) #outer join is the family of functions - full_join is the function name we would want to use here
```



6. Subset the `gapminder` dataset to have countries that are only found in the `areas` data frame. 

```{r}
semi_join(gapminder, areas)
```


7. Subset the `gapminder` dataset to have countries that are _not_ found in the `areas` data frame. 

```{r}
anti_join(gapminder, areas)
```

