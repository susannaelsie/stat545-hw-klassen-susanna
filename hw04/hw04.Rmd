---
title: "hw04"
output: html_document
---

First I'll need to load the tidyverse and knitr packages:

```{r}
library(tidyverse)
library(knitr)
```


## Introducing my tasks for this assignment

I have imported several data tables into my local environment, but want to create a new dataset to work with that will contain information from both. Specifically, I am interested in the various levels of off-farm paid work and on-farm capital in various Census Divisions (CD) in British Columbia (BC), particularly those with a high number of blueberry farms.

All of the data frames have values for each CD in BC, but they vary in their number of observations per CD (some have many as they are count data across various categories). All data frames have values for both 2011 and 2016. 

## 1. Re-shaping my data

I am going to perform a variation on Activity #2, using Stats Canada Agricultural Census Data instead of the Gapminder data. 

### 1.1 Using ```gather``` to make a longer dataframe

Currently, one of my dataframes has 2 variables (columns) for each year, and I'd like to re-shape it so that it has a single row per year (and one variable for number of "farms reporting blueberries").

```{r}
knitr::kable(Blueberry_Farms)
```

To re-shape this, I'll use the ```gather``` function. I'll also name this new table "bf", arrange the observations by CD_Region, select for the Census Division name, year, and number of blueberry farms.   

```{r}
bf <- Blueberry_Farms %>%
  gather(key = "year", value = "blueberry_farms", "2011":"2016") %>%
  arrange(CD_Region) %>%
  select(CD_Region, year, blueberry_farms) 
  knitr::kable(bf)
```

### 1.2 Make a plot comparing number of blueberry farms by region

While in the hw04 description activity 2 (re-shaping) involves plotting life expectancy in 2 countries to compare (using multiple years of data), here I only have 2 years of data, but am interested to compare multiple regions. Let's figure out which regions have the highest number of blueberry farms.

```{r}
bf %>% 
  arrange(blueberry_farms) # Need to integrate argument for descending order?
  knitr::kable(bf) # And figure out why when I add this the arrange function no longer works...
```


```{r}
bf %>%
  filter(CD_Region %in% c("Fraser Valley", "Greater Vancouver", "Capital", "Comox Valley")) %>%
  ggplot(aes(x = CD_Region, y = blueberry_farms)) +
  geom_col(aes(color=year), position = "dodge")
```

It is interesting to see from this plot that the four Census Divisions with highest number of blueberry farms have shown different trends from 2011 and 2016 -- with the Fraser Valley and the Comox Valley showing an increase, and the Capital and Greater Vancouver regions showing a decrease. 

### Preparing additional dataframes

I'd also like to take a look at the extent of paid off-farm work in various different CDs. The dataframe for 'PaidNonFarmWork' also has columns for year, so I will again use ```gather``` so that these two dataframes are in the same format.


```{r}
ofw <- PaidNonFarmWork %>%
  gather(key = "year", value = "number_operators", "2011":"2016") %>%
  arrange(CD_Region) %>%
  select(CD_Region, Avg_Hrs_OffFarmWork, year, number_operators) 
  knitr::kable(ofw)
```

Now we have a row for each year of data, and I've defined this new dataframe 'ofw'. 

Now, I'd like to define a single measure for each region to indicate the extent of off-farm work. I think that the proportion of farm operators that work 20+ hours a week off of the farm should be a good measure, so I have some additional re-shaping to do...

First, I am going to ```spread``` the data so that I can have the number of operators in each 'bin' as variables instead of observations (this is temporary). Now I want to create a new variable for the proportion of farm operators in each region that wor 20+ hours off the farm (PropOp_20)

I also want to rename the columns, and will use the plyr package to do this

```{r}
ofw_wide <- ofw %>%
  spread(Avg_Hrs_OffFarmWork, number_operators) %>%
  summarize()

```

Now, 

```{r}
ofw %>%
  group_by(CD_Region) %>%
  mutate(PropOp_20 = sum())

```




I'd also like to take a look at values of on-farm capital in various different CDs. The dataframe for 'Total On-farm Capital' also has columns for year, so I will once again use ```gather``` so that these two dataframes are in the same format.

```{r}
fc <- TotalFarmCapital %>%
  gather(key = "year", value = "number_farms", "2011":"2016") %>%
  arrange(CD_Region) %>%
  select(CD_Region, Farms_TotFarmCap, year, number_farms) 
  knitr::kable(fc)
```

Now we have a row for each year of data, and I've defined this new dataframe 'fc'. However, I'd like to define a single measure for each region to indicate the level of farm capital in the region. I think that the proportion of farms in each region with 




```{r}
knitr::kable(TotalFarmCapital)
```

```{r}
fc <- TotalFarmCapital %>%
  summarize()
```


Could look at the four categories (1, 2, 3 and 4 of size of farm capital) in the fraser valley (filter for this region only) using faceting to display the 2 years? 


```{r}
TotalFarmCapital %>%
  filter(CD_Region %in% c("Fraser Valley", "Greater Vancouver", "" ) )
  summarize()
```

